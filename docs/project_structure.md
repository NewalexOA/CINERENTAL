# Структура проекта ACT-RENTAL

## Обзор архитектуры

ACT-RENTAL использует многослойную архитектуру с четким разделением ответственности:

### 1. Слои приложения

#### API Layer (Presentation)
- Обрабатывает HTTP запросы
- Валидирует входные данные
- Маршрутизирует запросы к соответствующим сервисам
- Форматирует ответы

#### Service Layer (Business Logic)
- Реализует бизнес-логику
- Координирует работу с различными репозиториями
- Обеспечивает транзакционность операций
- Применяет бизнес-правила и ограничения

#### Repository Layer (Data Access)
- Обеспечивает доступ к данным
- Абстрагирует работу с базой данных
- Реализует CRUD операции
- Оптимизирует запросы

### 2. Структура файлов

```
backend/
├── api/                    # API endpoints
│   └── v1/
│       ├── api.py         # Основной роутер API
│       └── endpoints/      # Endpoint handlers
│           ├── auth.py    # Аутентификация
│           ├── equipment.py
│           ├── categories.py
│           ├── clients.py
│           ├── bookings.py
│           └── documents.py
├── core/                   # Ядро приложения
│   ├── config.py          # Конфигурация
│   ├── database.py        # Инициализация БД
│   ├── exceptions.py      # Пользовательские исключения
│   └── cache.py           # Инициализация Redis
├── models/                 # SQLAlchemy модели
│   ├── base.py           # Базовая модель
│   ├── equipment.py
│   ├── category.py
│   ├── client.py
│   ├── booking.py
│   └── document.py
├── repositories/          # Работа с данными
│   ├── base.py          # Базовый репозиторий
│   ├── equipment.py
│   ├── category.py
│   ├── client.py
│   ├── booking.py
│   └── document.py
├── services/             # Бизнес-логика
│   ├── base.py         # Базовый сервис
│   ├── equipment.py
│   ├── category.py
│   ├── client.py
│   ├── booking.py
│   └── document.py
├── schemas/             # Pydantic схемы
│   ├── base.py        # Базовые схемы
│   ├── equipment.py
│   ├── category.py
│   ├── client.py
│   ├── booking.py
│   └── document.py
├── tests/              # Тесты
│   ├── conftest.py    # Общая конфигурация тестов
│   ├── unit/         # Модульные тесты
│   │   ├── test_equipment_service.py
│   │   ├── test_category_service.py
│   │   ├── test_client_service.py
│   │   ├── test_booking_service.py
│   │   └── test_document_service.py
│   └── integration/  # Интеграционные тесты
│       ├── conftest.py  # Конфигурация интеграционных тестов
│       ├── test_business_processes.py  # Тесты бизнес-процессов
│       ├── test_service_interactions.py  # Тесты взаимодействия сервисов
│       └── test_edge_cases.py  # Тесты крайних случаев
└── main.py           # Точка входа приложения

docker/               # Docker-related файлы
├── create-multiple-postgresql-databases.sh  # Создание тестовых БД
├── init-test-db.sh                         # Инициализация тестовой БД
└── wait-for-postgres.sh                    # Ожидание готовности БД
```

### 3. Тестирование

#### Модульные тесты (Unit Tests)
- Тестируют отдельные компоненты в изоляции
- Используют моки для внешних зависимостей
- Проверяют базовую функциональность
- Быстрое выполнение

#### Интеграционные тесты (Integration Tests)
- Тестируют взаимодействие компонентов
- Используют реальную БД и Redis
- Проверяют сложные бизнес-процессы
- Тестируют крайние случаи

##### Тесты бизнес-процессов
- Проверка процесса бронирования
- Тестирование жизненного цикла бронирования
- Проверка иерархии категорий
- Тестирование жизненного цикла документов

##### Тесты взаимодействия сервисов
- Проверка создания бронирования с документами
- Тестирование полного процесса бронирования
- Проверка доступности оборудования

##### Тесты крайних случаев
- Проверка валидации дат бронирования
- Тестирование переходов статусов документов
- Проверка доступности оборудования
- Тестирование soft delete
- Проверка изменений статусов оборудования

### 4. Основные компоненты

#### FastAPI Application (main.py)
- Инициализация FastAPI приложения
- Подключение middleware (CORS)
- Подключение роутеров
- Конфигурация OpenAPI

#### Configuration (core/config.py)
- Настройки приложения
- Переменные окружения
- Конфигурация баз данных
- Параметры безопасности

#### Database (core/database.py)
- Асинхронное подключение к PostgreSQL
- Управление сессиями
- Базовый класс для моделей
- Миграции с помощью Alembic

#### Cache (core/cache.py)
- Асинхронное подключение к Redis
- Управление кешированием
- Обработка соединений

### 5. Технологии

- **FastAPI**: Веб-фреймворк
- **SQLAlchemy**: ORM для работы с базой данных
- **Pydantic**: Валидация данных
- **PostgreSQL**: Основная база данных
- **Redis**: Кеширование
- **Docker**: Контейнеризация
- **Alembic**: Миграции базы данных
- **pytest**: Тестирование

### 6. Безопасность

- CORS настройки
- Аутентификация через JWT
- Валидация входных данных
- Безопасное хранение паролей
- Ограничение размера файлов
- Обработка исключений

### 7. Масштабируемость

- Асинхронные операции
- Кеширование частых запросов
- Оптимизация запросов к БД
- Контейнеризация сервисов
- Возможность горизонтального масштабирования
