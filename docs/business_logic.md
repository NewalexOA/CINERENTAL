# Бизнес-логика CINERENTAL

## Общая информация

CINERENTAL - это система управления арендой кинооборудования. Основные бизнес-процессы включают:
- Управление каталогом оборудования
- Работа с клиентами
- Управление бронированиями
- Обработка документов

## Управление оборудованием

### Переходы статусов оборудования

Оборудование может находиться в одном из следующих состояний:
- `AVAILABLE` (доступно) - оборудование доступно для бронирования
- `RENTED` (в аренде) - оборудование находится в аренде
- `MAINTENANCE` (обслуживание) - оборудование на техническом обслуживании
- `BROKEN` (сломано) - оборудование сломано и требует ремонта
- `RETIRED` (списано) - оборудование списано и больше не доступно

Разрешенные переходы статусов:
- Из `AVAILABLE`: можно перейти в `RENTED`, `MAINTENANCE`, `BROKEN` или `RETIRED`
- Из `RENTED`: можно перейти в `AVAILABLE`, `BROKEN` или `MAINTENANCE`
- Из `MAINTENANCE`: можно перейти в `AVAILABLE`, `BROKEN` или `RETIRED`
- Из `BROKEN`: можно перейти в `MAINTENANCE` или `RETIRED`
- Из `RETIRED`: переходы запрещены (конечное состояние)

Дополнительные правила:
- Нельзя списать оборудование, если есть активные бронирования
- Оборудование в статусе `MAINTENANCE`, `BROKEN` или `RETIRED` нельзя забронировать
- Все изменения статусов логируются для аудита
- При удалении используется soft delete для сохранения истории

### Управление категориями

Категории организованы в иерархическую структуру:
- Каждая категория может иметь родительскую категорию и несколько дочерних
- Подсчет оборудования включает единицы из всех подкатегорий
- Поиск категорий осуществляется по названию и описанию (без учета регистра)
- Корневые категории - это категории без родителя

Основные операции:
- Создание новых категорий с опциональным родителем
- Перемещение категорий в иерархии
- Подсчет общего количества оборудования
- Поиск категорий по названию и описанию
- Получение полного пути от корня до любой категории

## Управление каталогом оборудования

### Категории оборудования
- Каждая единица оборудования принадлежит к определенной категории
- Категории организованы в иерархическую структуру (родительские и дочерние категории)
- Категории содержат название и описание
- Система отслеживает количество оборудования в каждой категории

### Оборудование
- Каждая единица оборудования имеет уникальный штрих-код и серийный номер
- Оборудование может быть в разных статусах:
  - AVAILABLE (доступно)
  - RENTED (в аренде)
  - MAINTENANCE (на обслуживании)
  - BROKEN (сломано)
  - RETIRED (списано)
- Система отслеживает доступность оборудования на конкретные даты
- Для каждой единицы оборудования указывается:
  - Суточная стоимость аренды
  - Стоимость замены при утере/порче
  - Дополнительные заметки

## Работа с клиентами

### Регистрация клиентов
- Каждый клиент должен предоставить:
  - ФИО (имя и фамилия)
  - Email (уникальный)
  - Телефон
  - Паспортные данные
  - Адрес
- Опционально можно указать:
  - Название компании
  - Дополнительные заметки

### Статусы клиентов
- ACTIVE (активный)
- BLOCKED (заблокирован)
- ARCHIVED (в архиве)

### Отслеживание активности
- Система отслеживает активные бронирования клиента
- Система отслеживает просроченные бронирования
- История бронирований сохраняется для анализа
- Поддерживается soft delete для сохранения истории

## Управление бронированиями

### Создание бронирования
1. Проверка доступности оборудования на выбранные даты
2. Расчет общей стоимости аренды
3. Определение размера депозита
4. Создание бронирования в статусе PENDING

### Статусы бронирования
- PENDING (ожидает подтверждения)
- CONFIRMED (подтверждено)
- ACTIVE (активно)
- COMPLETED (завершено)
- CANCELLED (отменено)
- OVERDUE (просрочено)

### Статусы оплаты
- PENDING (ожидает оплаты)
- PARTIAL (частично оплачено)
- PAID (полностью оплачено)
- REFUNDED (возвращено)
- OVERDUE (просрочено)

### Процесс бронирования
1. Выбор оборудования и дат
2. Система проверяет доступность
3. Создается бронирование в статусе PENDING
4. Клиент вносит депозит
5. Бронирование переходит в статус CONFIRMED
6. При получении оборудования статус меняется на ACTIVE
7. При возврате оборудования:
   - Проверяется состояние оборудования
   - Фиксируется фактическая дата возврата
   - Рассчитывается финальная стоимость
   - Статус меняется на COMPLETED

## Обработка документов

### Типы документов
- CONTRACT (договор аренды)
- INVOICE (счет)
- RECEIPT (квитанция)
- PASSPORT (скан паспорта)
- DAMAGE_REPORT (акт о повреждении)
- INSURANCE (страховка)
- OTHER (прочее)

### Статусы документов
- DRAFT (черновик)
- PENDING (на рассмотрении)
- UNDER_REVIEW (на проверке)
- APPROVED (одобрен)
- REJECTED (отклонен)
- EXPIRED (истек)
- CANCELLED (отменен)

### Процесс работы с документами
1. Создание документа в статусе DRAFT
2. Загрузка файла документа с метаданными:
   - Название
   - Описание
   - Имя файла
   - Размер
   - MIME-тип
3. Проверка и одобрение документа
4. Изменение статуса на APPROVED
5. Документ становится действительным

## Бизнес-правила

1. Оборудование
   - Нельзя забронировать оборудование в статусе BROKEN или RETIRED
   - Нельзя забронировать оборудование на уже занятые даты
   - Каждая единица оборудования должна иметь уникальный штрих-код и серийный номер
   - При удалении используется soft delete для сохранения истории

2. Клиенты
   - Email должен быть уникальным
   - Заблокированные клиенты не могут создавать новые бронирования
   - Клиенты с просроченными бронированиями не могут создавать новые
   - При удалении используется soft delete для сохранения истории

3. Бронирования
   - Депозит обязателен для подтверждения бронирования
   - Нельзя изменить даты на уже занятые
   - Отмена бронирования возможна только до его начала
   - Возврат депозита зависит от времени до начала бронирования
   - Фиксируется фактическая дата возврата оборудования

4. Документы
   - Договор обязателен для каждого бронирования
   - Документы в статусе DRAFT можно редактировать
   - Одобренные документы нельзя изменять
   - Каждый документ связан с конкретным клиентом
   - Документы могут быть опционально связаны с бронированием
