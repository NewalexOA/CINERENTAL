# Архитектурная документация CINERENTAL

## 1. Слои приложения

### Слой представления (UI)
- Веб-интерфейс на основе Bootstrap
- Компоненты для работы со сканером штрих-кодов
- Формы ввода данных и представления

### API слой
В качестве основного фреймворка выбран FastAPI по следующим причинам:
- Асинхронная обработка запросов (важно для быстрого отклика при сканировании)
- Автоматическая валидация данных через Pydantic
- Автоматическая генерация OpenAPI документации
- Высокая производительность

### Сервисный слой (Бизнес-логика)
Реализованы следующие сервисы:
- BookingService (управление бронированиями)
- EquipmentService (управление оборудованием)
- ClientService (управление клиентами)
- CategoryService (управление категориями)
- DocumentService (управление документами)

### Слой доступа к данным (Repository)
- Репозитории PostgreSQL с асинхронным доступом через SQLAlchemy
- Кеширование часто запрашиваемых данных в Redis
- Абстракция для работы с файловым хранилищем

## 2. Структура проекта
```
cinerental/
├── backend/
│   ├── api/              # FastAPI маршруты и эндпоинты
│   ├── services/         # Бизнес-логика
│   ├── repositories/     # Операции с базой данных
│   ├── models/          # SQLAlchemy и Pydantic модели
│   └── core/            # Конфигурация и утилиты
├── frontend/
│   ├── static/          # CSS, JS, изображения
│   └── templates/       # HTML шаблоны
├── tests/               # Тесты
│   ├── unit/           # Модульные тесты
│   └── integration/    # Интеграционные тесты
└── docker/             # Docker конфигурация
```

## 3. Используемые паттерны

### Repository Pattern
- Абстрагирует операции с базой данных
- Предоставляет чистый интерфейс для доступа к данным
- Реализован через базовый класс BaseRepository

### Service Layer Pattern
- Инкапсулирует бизнес-логику
- Координирует работу между различными репозиториями
- Управляет транзакциями
- Реализован через специализированные сервисные классы

## 4. Интеграция сканера штрих-кодов
- Специальный API endpoint для обработки сканированных кодов
- Поддержка режима HID (эмуляция клавиатуры)
- Быстрый поиск по штрих-коду через индексированные поля

## 5. Управление данными
- Миграции базы данных через Alembic
- ORM: SQLAlchemy для асинхронных операций с базой данных
- Кеширование в Redis для оптимизации производительности
- Оптимизированные запросы с использованием индексов

## 6. Масштабируемость
### Docker контейнеризация
Отдельные контейнеры для:
- Backend приложения
- Frontend статических файлов
- PostgreSQL базы данных
- Redis кеша

### Требования к производительности
- Время отклика при сканировании < 1 секунды
- Оптимизация базы данных для работы с до 10,000 записей
- Индексированные поля для быстрого поиска по штрих-кодам

## 7. Безопасность
- Базовая аутентификация для MVP версии
- Хеширование паролей
- Валидация входных данных через Pydantic
- Настроенная CORS конфигурация

## 8. Тестирование
### Модульные тесты
- Тестирование сервисов
- Тестирование репозиториев
- Изолированные тесты бизнес-логики

### Интеграционные тесты
- Тестирование API endpoints
- Тестирование бизнес-процессов
- Тестирование граничных случаев

### Инфраструктура тестирования
- Фикстуры для настройки тестового окружения
- Отдельная тестовая база данных
- Автоматизированное выполнение через Docker

## 9. Мониторинг и логирование
- Структурированное логирование
- Отслеживание ошибок и исключений
- Мониторинг производительности API

## 10. Развертывание
- Многостадийные Docker сборки
- Отдельные конфигурации для разработки и продакшена
- Скрипты для автоматизации развертывания
