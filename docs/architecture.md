# Архитектурная документация ACT-RENTAL

## 1. Слои приложения

### Слой представления (UI)
- Веб-интерфейс на основе Bootstrap
- Компоненты для работы со сканером штрих-кодов
- Формы ввода данных и представления
- Компоненты живого поиска с мгновенным обновлением результатов

### API слой
В качестве основного фреймворка выбран FastAPI по следующим причинам:
- Асинхронная обработка запросов (важно для быстрого отклика при сканировании)
- Автоматическая валидация данных через Pydantic
- Автоматическая генерация OpenAPI документации
- Высокая производительность

### Сервисный слой (Бизнес-логика)
Реализованы следующие сервисы:
- BookingService (управление бронированиями)
- EquipmentService (управление оборудованием)
- ClientService (управление клиентами)
- CategoryService (управление категориями)
- DocumentService (управление документами)

### Слой доступа к данным (Repository)
- Репозитории PostgreSQL с асинхронным доступом через SQLAlchemy
- Кеширование часто запрашиваемых данных в Redis
- Абстракция для работы с файловым хранилищем
- Оптимизированные запросы с использованием индексов для быстрого поиска

## 2. Структура проекта
```
cinerental/
├── backend/
│   ├── api/              # FastAPI маршруты и эндпоинты
│   ├── services/         # Бизнес-логика
│   ├── repositories/     # Операции с базой данных
│   ├── models/          # SQLAlchemy и Pydantic модели
│   └── core/            # Конфигурация и утилиты
├── frontend/
│   ├── static/          # CSS, JS, изображения
│   └── templates/       # HTML шаблоны
├── tests/               # Тесты
│   ├── unit/           # Модульные тесты
│   └── integration/    # Интеграционные тесты
└── docker/             # Docker конфигурация
```

## 3. Используемые паттерны

### Repository Pattern
- Абстрагирует операции с базой данных
- Предоставляет чистый интерфейс для доступа к данным
- Реализован через базовый класс BaseRepository

### Service Layer Pattern
- Инкапсулирует бизнес-логику
- Координирует работу между различными репозиториями
- Управляет транзакциями
- Реализован через специализированные сервисные классы

## 4. Интеграция сканера штрих-кодов
- Специальный API endpoint для обработки сканированных кодов
- Поддержка режима HID (эмуляция клавиатуры)
- Быстрый поиск по штрих-коду через индексированные поля

## 5. Управление данными
- Миграции базы данных через Alembic
- ORM: SQLAlchemy для асинхронных операций с базой данных
- Кеширование в Redis для оптимизации производительности
- Оптимизированные запросы с использованием индексов

## 6. Масштабируемость
### Docker контейнеризация
Отдельные контейнеры для:
- Backend приложения
- Frontend статических файлов
- PostgreSQL базы данных
- Redis кеша

### Требования к производительности
- Время отклика при сканировании < 1 секунды
- Оптимизация базы данных для работы с до 10,000 записей
- Индексированные поля для быстрого поиска по штрих-кодам

## 7. Безопасность
- Базовая аутентификация для MVP версии
- Хеширование паролей
- Валидация входных данных через Pydantic
- Настроенная CORS конфигурация

## 8. Тестирование
### Модульные тесты
- Тестирование сервисов
- Тестирование репозиториев
- Изолированные тесты бизнес-логики

### Интеграционные тесты
- Тестирование API endpoints
- Тестирование бизнес-процессов
- Тестирование граничных случаев

### Инфраструктура тестирования
- Фикстуры для настройки тестового окружения
- Отдельная тестовая база данных
- Автоматизированное выполнение через Docker

## 9. Мониторинг и логирование
- Структурированное логирование
- Отслеживание ошибок и исключений
- Мониторинг производительности API

## 10. Развертывание
- Многостадийные Docker сборки
- Отдельные конфигурации для разработки и продакшена
- Скрипты для автоматизации развертывания

## 5. Ключевые функциональные возможности

### 5.1. Живой поиск оборудования
Реализована функциональность мгновенного поиска по таблице оборудования с фильтрацией результатов в реальном времени:

- **Frontend**: JavaScript модуль с debounce для предотвращения частых запросов
- **Backend**: Оптимизированные запросы с использованием ILIKE и GIN индексов
- **База данных**: Индексы на основе pg_trgm для эффективного поиска подстрок
- **Производительность**: Время отклика < 300мс даже при большом объеме данных

Подробная документация: [Живой поиск оборудования](features/live_search.md)

### 5.2. Система бронирования
Система бронирования оборудования обеспечивает полный цикл управления арендой оборудования:

- **Frontend**: Интерактивный календарь доступности и форма бронирования
- **Backend**: Сервисы для проверки доступности, создания и управления бронированиями
- **База данных**: Оптимизированные запросы с использованием временных индексов
- **Бизнес-логика**: Проверка конфликтов, расчет стоимости, управление статусами

Основные возможности:
- Проверка доступности оборудования на выбранные даты
- Создание, редактирование и отмена бронирований
- Автоматический расчет стоимости аренды
- Генерация документов (договоры, акты, счета)
- Уведомления о предстоящих возвратах оборудования
- Интеграция со сканером штрих-кодов для быстрой обработки

### 5.3. Управление клиентами
Система управления клиентами предоставляет инструменты для работы с клиентской базой:

- **Frontend**: Интерфейс для просмотра, создания и редактирования клиентов
- **Backend**: Сервисы для управления данными клиентов и их историей
- **База данных**: Оптимизированная структура для хранения клиентской информации
- **Интеграции**: Возможность экспорта/импорта данных в различные форматы

Основные возможности:
- Создание и редактирование профилей клиентов
- Хранение контактной информации и истории взаимодействия
- Просмотр истории бронирований клиента
- Система рейтинга и статусов клиентов
- Автоматические уведомления клиентов
- Поиск клиентов по различным параметрам

### 5.4. Управление документами
Система управления документами обеспечивает автоматизацию документооборота:

- **Frontend**: Интерфейс для генерации и просмотра документов
- **Backend**: Сервисы для создания, хранения и управления документами
- **Шаблоны**: Настраиваемые шаблоны для различных типов документов
- **Хранение**: Структурированное хранение с возможностью быстрого поиска

Основные возможности:
- Автоматическая генерация договоров аренды
- Создание актов приема-передачи оборудования
- Формирование счетов и финансовых документов
- Электронное подписание документов
- Хранение истории изменений документов
- Экспорт документов в различные форматы (PDF, DOCX)
