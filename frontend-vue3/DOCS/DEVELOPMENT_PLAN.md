# CINERENTAL Vue3 Development Plan

This document outlines the comprehensive development plan for migrating the CINERENTAL frontend to Vue3, based on the project's strategic and architectural documentation. The plan is divided into phases that align with the `MIGRATION_STRATEGY_DOCUMENT.md`.

---

## Phase 1: Foundation (Weeks 1-3)

### Шаг 1: Настройка Основ и Окружения (Недели 1-2)

Этот этап является фундаментом для всего проекта. Первоочередная задача — создать стабильную и воспроизводимую среду разработки для всей команды. Это включает в себя настройку Node.js и pnpm, как указано в `DEVELOPMENT_ENVIRONMENT_SETUP_GUIDE.md`. Затем следует инициализация проекта Vue3 с помощью `pnpm create vue@latest`, включая TypeScript, Router, Pinia, Vitest, Playwright, ESLint и Prettier. После этого необходимо настроить структуру каталогов (`src/components`, `src/composables` и т.д.) и интегрировать базовые конфигурации (`.eslintrc.js`, `tsconfig.json`, `prettierrc`) из `CODING_STANDARDS_STYLE_GUIDE.md`. Наконец, настраивается Docker-окружение для разработки (`Dockerfile.dev`, `docker-compose.dev.yml`) для обеспечения согласованности сред. Успешное завершение этого этапа означает, что каждый разработчик может запустить проект локально командой `pnpm dev` и увидеть стартовую страницу Vue.

### Шаг 2: Реализация Базовой Архитектуры (Недели 2-3)

На этом этапе закладывается архитектурный каркас приложения. Основываясь на `API_INTEGRATION_SPECIFICATION.md` и `SYSTEM_ARCHITECTURE_DOCUMENT.md`, первым делом реализуется `HttpClient` — централизованный клиент для взаимодействия с FastAPI бэкендом. Он должен включать перехватчики (interceptors) для автоматического добавления JWT токенов в заголовки запросов и стандартизированную обработку ошибок (включая обработку 401 Unauthorized для выхода из системы). Параллельно, согласно `TECHNICAL_DESIGN_DOCUMENT.md`, создаются базовые хранилища Pinia: `authStore` для управления аутентификацией и `notificationStore` для обратной связи с пользователем. Настраивается Vue Router с основными маршрутами (`/vue/`, `/vue/equipment`, `/vue/projects` и т.д.), как описано в `MIGRATION_STRATEGY_DOCUMENT.md`, и внедряются навигационные хуки (navigation guards) для защиты роутов, требующих аутентификации. Наконец, разрабатываются ключевые composables, такие как `useAsyncState` и `useErrorHandler`, для унифицированного управления асинхронными операциями и ошибками во всем приложении.

---

## Phase 2: Core Infrastructure & Components (Weeks 3-4)

### Шаг 3: Создание Библиотеки Базовых Компонентов (Недели 3-4)

Этот этап фокусируется на создании визуального языка и переиспользуемых UI-элементов, как описано в `COMPONENT_LIBRARY_SPECIFICATION.md`. Работа начинается с внедрения дизайн-токенов (цвета, отступы, типографика) в виде CSS-переменных или конфигурации TailwindCSS для обеспечения консистентности. Далее, разрабатываются примитивные (Base) компоненты: `BaseButton`, `BaseInput`, `BaseModal`, `BaseIcon`. Эти компоненты должны быть максимально гибкими и настраиваемыми через props. После этого создаются композитные компоненты, такие как `SearchInput` (который использует `BaseInput` и `BaseIcon`), `StatusBadge` и `DataTable`. Наконец, разрабатываются компоненты макета (`PageLayout`, `NavigationMenu`, `Sidebar`), которые определят общую структуру страниц нового Vue3-фронтенда. Весь код должен строго соответствовать `CODING_STANDARDS_STYLE_GUIDE.md`.

---

## Phase 3: Critical Feature Migration (Weeks 5-8)

### Шаг 4: Миграция Критического Функционала — Universal Cart (Недели 5-6)

Это первая и самая сложная задача по миграции. На основе детального анализа в `task-uc-*.md` и `TECHNICAL_DESIGN_DOCUMENT.md`, разработка начинается с создания `cart.ts` — хранилища Pinia. Это хранилище будет управлять всей бизнес-логикой: добавление/удаление позиций, управление количеством, кастомными датами для каждой позиции и пакетное создание бронирований. Особое внимание уделяется реализации логики персистентности в localStorage с использованием динамических ключей (в зависимости от проекта) и версионирования. Далее создаются UI-компоненты: `UniversalCart.vue` (главный компонент, управляющий логикой двойного режима — встроенного и плавающего), `CartItemsList.vue` (список позиций, возможно, с виртуальным скроллингом для производительности) и `CartItem.vue` (отдельная позиция). Наконец, выполняется интеграция UI с хранилищем Pinia и API-сервисами для валидации доступности оборудования в реальном времени при изменении дат.

### Шаг 5: Миграция Функционала Управления Оборудованием (Недели 7-8)

Этот шаг охватывает основной каталог оборудования. На основе `task-2.1-equipment-list-ux-analysis.md` и `TECHNICAL_DESIGN_DOCUMENT.md`, сначала создается хранилище `equipment.ts` в Pinia для управления состоянием списка оборудования, фильтров и пагинации. Затем разрабатывается страница `EquipmentListView.vue`. Ключевой задачей здесь является реализация высокопроизводительной таблицы или сетки для отображения 845+ единиц оборудования. Согласно анализу производительности (`task-po-1-*.md`), необходимо внедрить **виртуальный скроллинг** для предотвращения проблем с производительностью DOM. Компоненты `EquipmentFilters.vue` и `PaginationControls.vue` (созданные на Шаге 3) интегрируются для управления фильтрацией и пагинацией, с обязательной синхронизацией состояния с URL. Далее создается страница `EquipmentDetailView.vue`, отображающая полную информацию, историю бронирований и таймлайн статусов. Наконец, кнопки "Добавить в корзину" на обеих страницах интегрируются с `useCartStore` (из Шага 4).

---

## Phase 4: Advanced Features & Workflows (Weeks 8-10)

### Шаг 6: Интеграция HID-сканера (Недели 8-9)

Это третья критически важная и рискованная задача. Основываясь на `task-hs-1-*.md` и `TECHNICAL_DESIGN_DOCUMENT.md`, создается composable `useScanner.ts`. Его ядро — алгоритм, который слушает события клавиатуры и по временным задержкам (<20ms) отличает ввод со сканера от ручного набора. Этот composable должен предоставлять методы `start()` и `stop()` и вызывать колбэк `onScan(barcode)`. Далее, создается хранилище Pinia `scanner.ts` для управления сессиями сканирования, как описано в `task-hs-2-*.md`. Оно будет отвечать за создание, загрузку, сохранение сессий в localStorage и их синхронизацию с сервером, включая логику обработки дубликатов (для серийных номеров) и увеличения количества ( для несерийных). Затем разрабатывается UI-компонент `ScannerInterface.vue`, который использует `useScanner` и `scanner.ts` для отображения сессий, списка отсканированного оборудования и предоставляет элементы управления для конвертации сессии в новый проект.

### Шаг 7: Миграция Остальных Функциональных Модулей (Недели 9-10)

После завершения работы над критическими компонентами, этот этап фокусируется на переносе оставшихся бизнес-процессов. На основе `task-3.1-*.md` и `task-3.2-*.md`, создаются страницы управления проектами: `ProjectListView.vue` (с двойным режимом отображения — таблица/карточки и фильтрацией) и `ProjectDetailView.vue`. Главной задачей на странице деталей проекта является интеграция `UniversalCart.vue` (из Шага 4) во встроенном режиме (embedded mode). Далее, на основе `task-6.1-*.md` и `task-6.2-*.md`, реализуются страницы управления клиентами и бронированиями. Эти страницы будут активно переиспользовать уже созданные базовые компоненты, такие как `DataTable`, `PaginationControls` и `SearchInput`. Наконец, реализуется интеграция с системой генерации документов: создаются кнопки "Печать", которые отправляют запросы к бэкенду для генерации PDF-файлов и открывают их в новой вкладке.

---

## Phase 5: Quality Assurance & Deployment (Weeks 11-12)

### Шаг 8: Комплексное Тестирование и Обеспечение Качества (Недели 11-12)

Этот этап посвящен верификации качества и стабильности нового приложения. В соответствии с `TESTING_STRATEGY_DOCUMENT.md`, процесс делится на несколько уровней. Во-первых, **Unit-тестирование (Vitest)**: для каждого компонента, composable и хранилища Pinia пишутся модульные тесты, проверяющие их логику в изоляции. Цель — достичь покрытия кода >90%. Во-вторых, **Интеграционное тестирование (Vitest + MSW)**: здесь проверяется взаимодействие между компонентами и сервисами. Mock Service Worker (MSW) используется для перехвата API-запросов и симуляции ответов бэкенда, что позволяет тестировать полный поток данных без реального бэкенда. В-третьих, **End-to-End тестирование (Playwright)**: автоматизируются сквозные пользовательские сценарии, такие как полный цикл аренды оборудования (поиск -> корзина -> проект) и работа со сканером. Эти тесты запускаются во всех целевых браузерах (Chrome, Firefox, Safari). Наконец, проводятся **Тесты доступности (axe-core)** и **Производительности (Lighthouse CI)** для проверки соответствия стандартам WCAG и установленным бюджетам производительности.

### Шаг 9: Настройка CI/CD и Развертывание (Неделя 12)

Этот этап готовит приложение к выпуску и автоматизирует его доставку. На основе `DEPLOYMENT_GUIDE.md`, финализируется конфигурация сборки Vite для production: настраивается минификация кода, отключение source maps и разделение бандла на чанки (manualChunks) для оптимизации загрузки. Затем, согласно `MIGRATION_STRATEGY_DOCUMENT.md`, настраивается Nginx как обратный прокси. Это ключевой элемент стратегии: Nginx будет направлять запросы `/vue/*` на статические файлы нового Vue3-приложения, в то время как все остальные запросы будут по-прежнему обрабатываться старым бэкендом. Также настраивается проксирование `/api/*` на FastAPI. Далее, на основе `GIT_WORKFLOW_BRANCHING_STRATEGY.md`, создается полный CI/CD-пайплайн на GitHub Actions. Для каждого PR и пуша в `develop` запускаются линтеры, тесты и сборка. При мерже в `develop` происходит автоматическое развертывание на staging-окружение, а при мерже в `main` — на production. Наконец, финализируется многоступенчатый `Dockerfile` для production-сборки, который создает легковесный образ Nginx для раздачи статики.

---

## Post-Migration: Finalization & Adoption

### Шаг 10: Финализация, Оптимизация и Внедрение (Фаза 5 и далее)

Это заключительный этап, фокусирующийся на передаче продукта пользователям. На основе `MIGRATION_STRATEGY_DOCUMENT.md`, начинается **Пользовательское приемочное тестирование (UAT)**: ключевые пользователи (менеджеры по аренде, персонал склада) получают доступ к staging-окружению для проверки паритета функциональности и удобства использования. Их обратная связь используется для финальных доработок. Параллельно проводится **финальная оптимизация производительности** на основе отчетов Lighthouse и результатов UAT. Настраивается **мониторинг в production**: системы отслеживания ошибок (Sentry) и производительности. Затем начинается **поэтапное внедрение** с использованием feature-флагов: сначала для внутренней команды, затем для опытных пользователей, и, наконец, для всех сотрудников. После полного и стабильного внедрения нового фронтенда, планируется **вывод из эксплуатации** старого интерфейса на Bootstrap/jQuery, что включает удаление соответствующего кода и правил маршрутизации в Nginx.
